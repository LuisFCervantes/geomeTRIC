.. _transition:

Transition states
=================

Theory
------

A transition state (TS) is an energy maximum along a reaction pathway that connects reactant and product structures.  
It is a critical point on the potential energy surface (PES) that is characterized by one negative eigenvalue in the Hessian matrix, corresponding to an imaginary frequency in the vibrational analysis.
The TS is essential to theoretical estimates of reaction rates and testing of mechanistic hypotheses due to the exponential dependence of the reaction rate on the activation energy (the energy difference between the TS and reactant structures).

In contrast to energy minimization, TS optimization is designed to maximize the energy along the lowest eigenvalue mode of the Hessian.
Performance is best when the initial structure already has a negative eigenvalue in the Hessian matrix with an eigenvector that points along the direction of the expected reaction.
Therefore, it is important for TS optimizations to start with a high-quality initial guess that is already close to the desired optimized structure.
There are many ways to obtain an initial guess structure for TS optimizations, such as careful modeling based on chemical intuition, coordinate driving (i.e. scanning a constraint value), internal coordinate interpolation, reaction path optimization (such as nudged elastic band or the string method), and others.
The estimated TS structures generated by the above approximate methods are sometimes treated as the actual TS structures in the literature, but they are not as precise as "true" TS optimization.
This section assumes you already have an initial guess in hand.

By default, at the start of a TS optimization in geomeTRIC, the full Hessian matrix is calculated; this requires a large number of gradient calculations (6x the number of atoms), but they can be done in parallel.
During the optimization, the step is obtained using a restricted-step rational function optimization (RS-RFO) formalism that divides the optimization space into maximization and minimization subspaces and restricts the step to be within the trust radius.
The Hessian is updated using a formula suggested by Bofill that linearly combines the Murtagh-Sargent and Powell udpate formulas, which has the desired property of preserving the number of negative eigenvalues.
The initial and maximum trust radii are also set to 0.1x of the values used for energy minimization in order to ensure that the local shape of the PES stays the same along the optimization steps.

Usage
-----
To enable TS optimization in geomeTRIC, pass ``--transition yes`` on the command line when running ``geometric-optimize``.
Enabling this switch will change the step and Hessian update methods, and change the default values of the initial and maximum trust radius to 0.01 and 0.03 respectively.
In addition, the Cartesian Hessian will be computed before any optimization steps, along with a vibrational analysis to determine the normal modes.
If you want to automatically perform a second vibrational analysis after the optimization is complete, pass ``--hessian first+last`` on the command line.

GeomeTRIC prioritizes successful completion of TS optimizations at the cost of increasing the number of cycles needed to reach convergence.
The trust radius may be doubled by passing ``--trust 0.02 --tmax 0.06`` on the command line; this can reduce the number of cycles but increase the failure rate by a few percent.
Further increasing the trust radius is not recommended.

Hessian calculations & vibrational analysis
-------------------------------------------

The Hessian calculation and vibrational analyses should give the same results as if you had requested them directly from the quantum chemistry code.
After the vibrational analysis, the Gibbs free energy corrections are computed using an ideal gas / rigid rotor / harmonic oscillator approximation (imaginary frequency modes are ignored).

At present, geomeTRIC only supports the calculation of Hessians via finite difference of the gradient, and does not take advantage of analytic Hessians if the QC software has them.
On the other hand, the gradient calculations may be parallelized by distributing the jobs to remote "worker" nodes using the `Work Queue distributed computing library <https://ccl.cse.nd.edu/software/workqueue/>`_; this can greatly reduce the wall time relative to performing the gradient calculations serially.
To enable this behavior, first ensure that the Work Queue library and Python module are installed, then pass ``--port ####`` on the command line where ``####`` is a custom port number (I usually use a large four-digit number, such as 7953, that is not commonly used by other services).
Then run the ``work_queue_worker`` program on the worker node, providing the host name that is running ``geometric-optimize`` and the port number.
If successful, the worker will establish a connection to the master and begin to accept gradient jobs.
Parallelization is achieved by running multiple workers on one or more nodes (you can run workers locally too).

The Hessian calculation / vibrational analysis can be customized in other ways as well.
To provide a Hessian matrix from a file, pass ``--hessian file:/path/to/file`` on the command line (it must be stored as a NxN matrix in text format).
The free energy calculation may be customized by passing ``--thermo <temp> <pres>`` and providing the temperature and pressure.
Additionally, by passing ``--wigner <num_samples>`` one could obtain a desired number of sample points from the Wigner phase space distribution.
